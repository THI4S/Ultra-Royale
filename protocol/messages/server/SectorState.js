const Processor = require('../../processor')
const cardUtils = require('../../../utils/cardUtils');
const utils = require('../../../utils');

module.exports = class SectorState extends Processor {
    constructor(device, device2) {
        super()
        if (device2) {
            this.device2 = device2
        }
        this.device = device
        this.code = 21873
        this.version = 1
    }

    encode() {
        if (!this.device2) {
            this.data.writeRrsInt32(0);//Is compressed
            this.data.append(Buffer.from('012A02020100017F7F7F7F0000000000000100000000000000000000000000000800000000000000000100000000000000000000000102', 'hex'))
            //High and low id repeated 3 times
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeIString(this.device.player.name);
            let currentDeck = this.device.player.decks[this.device.player.selectedDeck];
            this.data.append(Buffer.from('199F368606A31D000000000029000000000008130501BB97040502AB10050302050400050C8C14050D00050E00050F98110516B21105199487979707051A04051C00051D8A88D5440521000522000523000524000526000525000000000505068F3C05078D0F050B2905140B051B0B011A320C00000B0202B8DB010000000869205061677572699201BE5193080094249023019F0318000000002B00217F0B0007037BF994EABEEA090229017F7F00', 'hex'));
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.append(Buffer.from('0000000000000000000601000009000000010000008E02F27D0000067A062301230123012301230023000100010000010500050105020503050405050A0DA4E2019C8E0300007F00C07C000002000000000000090DAC36A46500007F0080040000010000000000000A0DAC369C8E0300007F00C07C000001000000000000090DA4E201A46500007F008004000002000000000000090DA88C01B82E00007F00800400000000000000001A04047C067F0407030201007F7F7F007F00000500000000007F7F7F7F7F7F7F7F000000000A0DA88C0188C50300007F00C07C00000000000000001A04067C027D0407000305007F7F7F007F0000', 'hex'));
            this.data.writeRrsInt32(999);//Starting Elixir
            this.data.append(Buffer.from('00000000007F7F7F7F7F7F7F7F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000AC2F00A22B00AC2F00A22B00A84400984B0000000000A40100000000A40100000000A40100000000A40100000000A40100000000A401', 'hex'));
            //-- Trainer's deck --//
            this.data.append(Buffer.from('FF01190B8F010B090B2102200B140A10051F0A00', 'hex'));//190B8F010B090B2102200B140A10051F0A00', 'hex'));
            this.data.append(Buffer.from('FF01', 'hex'));
            currentDeck.forEach(cardSCID => {
                let card = utils.findObjectByKey(this.device.player.cards, 'ID', cardUtils.SCIDtoInstanceID(cardSCID));

                this.data.writeRrsInt32(card.ID);
                this.data.writeRrsInt32(card.level);
            });
            this.data.writeRrsInt32(0);
            this.data.append(Buffer.from('05060202040201030000000000000000000204000C00000093E5BFB00D00', 'hex'));
        }
        else {
            this.data.writeRrsInt32(0);//Is compressed
            this.data.append(Buffer.from('012A02020001020100000000155449445F4C41444445525F51554553545F504C4159000000000A0101000001010001', 'hex'));
            //Home player's data
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeIString(this.device.player.name);
            this.data.writeRrsInt32(5); //Unk
            this.data.writeRrsInt32(this.device.player.trophies); //Home player's trophies
            this.data.append(Buffer.from('001D0000000000290000000000080A0501BB02050206050302050400050D00050E00051C00051D8888D5440526000525000000000405061E050701050B29051B01000000010002000001017F050100000102', 'hex'));
            this.data.writeRrsInt32(this.device2.player.highID);
            this.data.writeRrsInt32(this.device2.player.lowID);
            this.data.writeRrsInt32(this.device2.player.highID);
            this.data.writeRrsInt32(this.device2.player.lowID);
            this.data.writeRrsInt32(this.device2.player.highID);
            this.data.writeRrsInt32(this.device2.player.lowID);
            this.data.writeIString(this.device2.player.name);
            this.data.writeRrsInt32(5); //Unk
            this.data.writeRrsInt32(this.device2.player.trophies); //Opponent's trophies
            this.data.append(Buffer.from('00000000000000290000000000080905019503050206050302050D00050E05051D8688D544052500050400051C0000000004050B29051B0105070105061E00000001000200000101010500000001002B0021ABCDD2AB0B0B000DB01BA3BBECAEFD0C030002', 'hex'));
            this.data.writeRrsInt32(this.device.player.highID);
            this.data.writeRrsInt32(this.device.player.lowID);
            this.data.writeRrsInt32(0);//Unk
            this.data.writeRrsInt32(this.device2.player.highID);
            this.data.writeRrsInt32(this.device2.player.lowID);
            this.data.append(Buffer.from('000000000000000000010100000700000000000000B903C77C0000067A06230123012301230123002300010001000001050005010502050305040505000DA4E2019C8E0300007F00C07C000002000000000000000DAC36A46500007F008004000001000000000000000DAC369C8E0300007F00C07C000001000000000000000DA4E201A46500007F008004000002000000000000000DA88C01B82E00007F00800400000000000000001A0400057F030406020301007F7F7F007F00000500000000007F7F7F7F7F7F7F7F00000000000DA88C0188C50300007F00C07C00000000000000001800000500000000007F7F7F7F7F7F7F7F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B81500B81500B81500B81500A02500A0250000000000A40100000000A40100000000A40100000000A40100000000A40100000000A401FF01010102010E008F01018E010004000D0013000000050602020402010300000000000000000101000C000000BCEF87EA0100', 'hex')); 
            //this.data.append(Buffer.from('012A02020001020100000000155449445F4C41444445525F51554553545F504C4159000000000A01010000010100010A95D6AC120A95D6AC120A95D6AC12000000044A656666021E001D0000000000290000000000080A0501BB02050206050302050400050D00050E00051C00051D8888D5440526000525000000000405061E050701050B29051B01000000010002000001017F0501000001022CBF8AC3132CBF8AC3132CBF8AC313000000085245447663524544021E00000000000000290000000000080905019503050206050302050D00050E05051D8688D544052500050400051C0000000004050B29051B0105070105061E00000001000200000101010500000001002B0021ABCDD2AB0B0B000DB01BA3BBECAEFD0C0300020A95D6AC12002CBF8AC313000000000000000000010100000700000000000000B903C77C0000067A06230123012301230123002300010001000001050005010502050305040505000DA4E2019C8E0300007F00C07C000002000000000000000DAC36A46500007F008004000001000000000000000DAC369C8E0300007F00C07C000001000000000000000DA4E201A46500007F008004000002000000000000000DA88C01B82E00007F00800400000000000000001A0400057F030406020301007F7F7F007F00000500000000007F7F7F7F7F7F7F7F00000000000DA88C0188C50300007F00C07C00000000000000001800000500000000007F7F7F7F7F7F7F7F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B81500B81500B81500B81500A02500A0250000000000A40100000000A40100000000A40100000000A40100000000A40100000000A401FF01010102010E008F01018E010004000D0013000000050602020402010300000000000000000101000C000000BCEF87EA0100', 'hex'));
        
        }
    }
}

module.exports.code = 21873
